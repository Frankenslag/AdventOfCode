
using System.Linq;
using System.Security.Cryptography.X509Certificates;

namespace AdventOfCode2024
{
    internal class Day6
    {
        private static readonly string[] Data =
        [
            ".......#.........#..............#........................#......#....#............................#..#...............#............",
            "...................#.............................................#...................................#............................",
            "...............#.................................##.........#..........#.....##...#...#.....#....#..................#.............",
            "#.............................................#..#.............#..........#.##.............................................#......",
            "#.........................................................#.....#........................................##.......................",
            "...........#.......#.#...........#....#.#...#......................................#...........................#...##............#",
            "........................................................#..#.....................................#..#................#....#...#...",
            "#.#.....#.........................#...........#.......................................#.......#.....................##............",
            ".......#..........##.....#........#..................................................#.........................................#.#",
            "#.#..............#.#.............................#............#....#...............#.........................#............#..#.#.#",
            "..........................................................#....................................................#..................",
            ".......................#....#...........#.....................#....#...#.......#..............#.......................#...........",
            "..............................#..............#.......#....................................#.....................#...#...#.........",
            "........#.................#...#....##..............#...........................#............................#.................#...",
            "..................#........................................#......#......................................................#........",
            ".............#.................#...#..............................................................................#...#...........",
            ".....................................#..........................................................#.#.#......#.........#............",
            "..........#...................................................................#.........##.......#..#.............................",
            "...#.#....................................#..#...........#.......................................................##...............",
            "........................................................................................................#.........................",
            ".........#...........#......#..............#........#....................#...#......#.............................................",
            "........#....#...............#....................#..........#.....................................#......#......#........#.#.....",
            "........................#..........................#.......#........................#................#......#.....................",
            "......................................#.........................................#............................#....................",
            "...................................#.#...#...........#.........................................#.....................#............",
            ".................#....#.....................................................................#..................#.........#........",
            "...........#...........................................................#.............................#...............#..#.........",
            "..#.....................#.........................................................................................................",
            "....................#....#.#...........................#...........................................#..............#...............",
            "...#...................................................#.............................................#.........#..........#.......",
            ".............................###.....#..#..#......................................................................................",
            "##................#.#.......#..............#.....#...............#..#............#................................................",
            "......#...............................................#.#..#............................#............#.................#..........",
            "........................................#.#...................................................#.....#.............................",
            "#.......#.#.......................#.....#....................................#...................#................................",
            "...##................................................................................................#.....................#......",
            "............#.............#..................#.................#..................................................................",
            "...#..............#..............................................................................#..........#......#..............",
            "...#..#...#................................................#.....................#......#......................#.......#..........",
            ".................#..#........#...............#.#................#......##.................#.................................#.....",
            "#.....#.......#...........................................#..........#..............................#...#.#..#......#.....#.......",
            "....................................#.........#........#..................#.............................................#.........",
            "#...............................#........................#.................................................#.....#................",
            "..#..................................#.......#.....................#..............................................................",
            "........#...#.....................................#......#..............#..#..#..........................#.#....#.................",
            ".............#..........#....#................#.......#..........................................#.....#..........................",
            ".............................................#................................#.........................#...#.....................",
            ".........#........#...................................................................#.......#....#..............................",
            "....................................#.......................#..............#...............................#......................",
            "....#....................#................................#....#...........#.............#........................................",
            "....#...........#...................#.#..................................................#.....................#..................",
            "..........#....................#............#.##...#.......#....#...............#.....#...#.........................#.............",
            ".......#....................................................................................................#.................#...",
            "...............................................................................#......#.................#...#.....................",
            "..................#........#..........#..........................................................................#................",
            "..........................................................................................#.......................................",
            ".#..#...........#.................................##...........................#.....#...................#..#.....................",
            "........................#..#..........................................................#............#..................#..........#",
            "...........#...................................................##...........................#...............................#.....",
            "........#......................................................................................................#..................",
            "........#..#............................#..#...........#..............................#......................#.##...........#....#",
            "........#...#.#..............#...#.....................#....................#.#..............................#....................",
            ".......................................................#....................................................#..#..................",
            "...........................................#......................#................#........................#....................#",
            ".............#...............#................................................................................#...................",
            "..#...#............#.............#.....#........................#............#....................#...............................",
            ".....#...................................................................................................................#........",
            "....................#..#...........#....#.............................................................................#.......#...",
            "..............#......#.........................#...........#...#...........................................#...#..................",
            "..............................#.....#.........................................................#......#.#......#...................",
            "............................................................#...................#.#............................#..................",
            ".............###.#........................................#........................................................#..............",
            "......#................................#...............##.........................................................................",
            ".........#.....#.#.....................#.......................................#...............#..........#....#....#.............",
            "..............................................#....................................#...........................................#..",
            "............#.#..........#........#..#.....#.............#..........#............#......#...................##..........#.........",
            "............#....#...................................#.............................#.........................#....................",
            ".#..................................#....#.........................................................................#..............",
            ".........................#...#...#.................#..................#.............#.#...#...............#.......................",
            ".........#...............................#...........#.............................#...........................#..........#.......",
            "......#..........................#.............#..........#.......................................................................",
            ".......#...............#.........#.............#...............................#..................................................",
            "..#......#....................##...........................................#........................................#.............",
            "..........................#.....#.......................#...........................................................#.#...........",
            "..#....................#.............#................................................................#.#.........................",
            ".........#....................#.....#....#...............#.......................#........#.......................................",
            "..............#...................................................................#................#...#..........................",
            "....................#.....#.......#..#......................................#...........#..................................##....#",
            ".......#.......................................................................#..................................................",
            "......#.............##..........................#..#......................^.......................................................",
            "..............................#..........#...................#.................................#.....................#............",
            ".......................##..........................#.......#..............................#...................................#.#.",
            "................#....................................................................#...............................#.........#..",
            "..........................................#......#.....................................#................#........#................",
            "#......................................#.......................................................#..#...........#...................",
            ".......#.............#..................#..#...#............#.......#.....#.....#.#...............................................",
            ".............................#........#.............#.....#.......#...................................#.#..................#......",
            ".................#......................................................................................#........#..#.............",
            "........................................................................#..............#.....#..............................#.....",
            "....#....#..........................................#......##...#....................#...................#..........#.............",
            ".................##.......................##.#.........#................................................#.........................",
            ".#..............................................#.........................#.#.#..........#.....................................##.",
            "............................................................#..........#....#...................................................#.",
            "....#...........#.............................#.....................#.........#..................#...........................#....",
            "......#.#.......#..#......#........#..#...................#....#..................................................................",
            "............#........................................................................................................#............",
            ".....................................................#..........................................#................#................",
            "...#.......#..#..............#.............................#....................................#.................................",
            ".................##.........#........................#....................................#...............#.#.#...................",
            "................#......#......................#..#..........................................#.....................................",
            "......#..................................................##.#.#........#...........................#.......................#......",
            "........................#............#......#.........#.............#.............................................#.....#.##......",
            "......................#........................................#.......#.........#.................#..#...........#...............",
            "..#.......#.........##..#.#................................................................................#.........#............",
            "........................................................................................#............#...........#................",
            "................#...#....................#..##..#...............#.............................................................#...",
            "...#........#..........................#.....#..........................#....................................#.........#.......##.",
            ".................#...........................#.........#......#............................#.....................#................",
            "...................#..........#....#.......#...................#.............................#..........#.........................",
            ".......#..............#.................................#.........#....................................#.................#....##.#",
            "..................................#.......................#....#..#.........................#....................#................",
            ".....#.........#............#...#.........#........#...................#...#......................#.....#............#............",
            "#.#....#...#........#................................##..........................#.............................##...#....#........",
            ".............##..........##...#......#.......#.#................#.#.......................#.............#.........................",
            ".............#....................................#....................................#..........................................",
            "..................................#..............................#.......................................#................#.......",
            "...................#...............#..............................................................................................",
            "....#........#.................................#........#.....................................#.......#................#........#.",
            ".................#......#.......................................................##.....#..................#.......................",
            "...............#.......................#.#........#...........................................#........#.........................."
        ];

        private static (int x, int y)[] Directions = [(0,-1), (1, 0), (0, +1), (-1, 0)];

        public static void Run()
        {
            string[] mapData = Data;

            int width = mapData[0].Length;
            int height = mapData.Length;
            List<(int x, int y, int d)> path = new();

            (int x, int y) startPosition = (-1, -1);

            List<(int, int)> obstacles = mapData.Select((line, row) => line.Select((c, col) => (c, col)).Where(c => c.c != '.').Aggregate(new List<(int, int)>(), (c, n) =>
            {
                if (n.c == '^')
                {
                    startPosition.x = n.col;
                    startPosition.y = row;
                }
                else
                {
                    c.Add(new(n.col, row));
                }

                return c;
            })).SelectMany(cr => cr).ToList();

            int paradoxes = 0;

            for (int run = 0; run < 2; run++)
            {
                List<(int x, int y)> paradoxCandidates = new();

                if (run == 1)
                {
                    paradoxCandidates = mapData.Select((line, row) => line.Select((c, col) => (c, col)).Where(c => c.c == '.').Select(p => (p.col, row))).SelectMany(p => p).ToList();
                }

                for (int i = 0; i < (run == 0 ? 1 : paradoxCandidates.Count); i++)
                {
                    (int x, int y) position = startPosition;
                    int direction = 0;

                    path.Clear();
                    path.Add(new(startPosition.x, startPosition.y, direction));

                    bool paradox = false;

                    while (!paradox && position.x + Directions[direction].x >= 0 && position.x + Directions[direction].x < width && position.y + Directions[direction].y >= 0 && position.y + Directions[direction].y < height)
                    {
                        while (obstacles.Contains(new(position.x + Directions[direction].x, position.y + Directions[direction].y))
                               || (run == 1 && position.x + Directions[direction].x == paradoxCandidates[i].x) && position.y + Directions[direction].y == paradoxCandidates[i].y)
                        {
                            direction = (direction + 1) % 4;
                        }

                        position.x += Directions[direction].x;
                        position.y += Directions[direction].y;

                        paradox = run == 1 && path.Any(p => p.x == position.x && p.y == position.y && direction == p.d);

                        if (!path.Any(p => p.x == position.x && p.y == position.y))
                        {
                            path.Add(new(position.x, position.y, direction));
                        }
                    }

                    if (paradox)
                    {
                        paradoxes++;
                    }

                }

                Console.WriteLine(run == 0 ? $"Day 6 Part 1 Answer is {path.Count} positions." : $"Day 6 Part 2 Answer is {paradoxes} paradoxes.");
            }
        }
    }
}
