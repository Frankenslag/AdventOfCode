using System.Security.Cryptography.X509Certificates;

namespace AdventOfCode2023
{
    internal class Day11
    {
        private static readonly string[] DataProd =
        [
            ".......#.....#.....................#.............#.................#.........................#..............................................",
            "#.....................#.......#.................................................................................#.......#...................",
            ".......................................................................#.........................#..................................#.......",
            "................................................................#..............#..............................................#.............",
            ".........................................#............................................................#....................................#",
            ".................#..................................................#.......................................................................",
            "...........................#...............................................................................#................................",
            "....#.......#...........................................#..........................#.............................#..........................",
            "....................#.............#........#................................................................................................",
            "...................................................#...................................................#...................#................",
            ".........................#........................................#..................................................#......................",
            "......#..........#...........................................#...........#............#.....................................................",
            "......................................#..........................................#.........................#.....................#..........",
            ".#...................#..................................#.......................................#...........................................",
            "............#.................................#.....................#.......................................................................",
            "............................................................................................................................................",
            "..............................#.....................................................................................#..................#....",
            "....................................................................................#........#......#.......................................",
            ".........................#.........................#............#...........................................#...............................",
            ".#......#.....#.......................#.................#........................................................#.....#....................",
            "...........................................................................#.................................................#..............",
            "...............................................#.......................................#...............#..........................#.........",
            "......................#..................#..................................................................................................",
            "..........................................................................................................................#.................",
            "......#...........................#.........................................................#........................#......................",
            "..............................................................................................................................#.............",
            "..#.......................#.................#............................................................................................#..",
            "..................#....................................................#................#...................................................",
            "....................................................#.....#....................#............................................................",
            "...............................#............................................................................................................",
            "..............................................#...............#..........................................................#...........#......",
            ".#.........#........................#..................................................................#....................................",
            "..........................................................................#.......................#........................................#",
            "...................#......................................................................#.................................................",
            ".............................................................................................................................#..............",
            ".....#......................................................................................................................................",
            "........................................................#........................#..........................................................",
            ".............................#...............#.....................#.....#............#..................#..............................#...",
            "............................................................................................#......#...........#............................",
            ".........................#........#...................................................................................#.....................",
            "...........................................................................................................................................#",
            ".....................................................#.....#.................................................................#..............",
            "#.........................................................................................................#.......................#.........",
            "................#...........................................................#.....................#.........................................",
            "..............................#..............#...................................#.......#...........................#......................",
            "........#................#.........#............................#............................................#.............#.........#......",
            "............................................................................................................................................",
            ".......................................................#...............#.............................#...........................#..........",
            ".............#.................................#............................................................................................",
            "............................................................................................................................................",
            "..#.............................................................................#...........................................#...........#...",
            "............................................................................................................................................",
            "......................................#..........................................................#................#.........................",
            "............................#................#......#......................#...........#....................................................",
            "............................................................................................................................................",
            "....................................................................................................#................#..........#...........",
            ".#............#...................#...............................#........................................#.............................#..",
            ".........#...............................................................#..................................................................",
            ".......................#....................#........#...........................................#..........................................",
            "............................................................#.....................................................#.........................",
            "..............................#.......................................................................#...................#.......#.........",
            "............#.......................#...................#............................#......................................................",
            "...................................................#......................................#..............................................#..",
            ".#................#...................................................#........................#............................................",
            "......#....................................................................#................................#...............................",
            "...............................#....................................................................................#.......................",
            ".........................#.....................#......#.............................................#.................................#.....",
            "............................................................................................................................................",
            "...............#.....................#....................................................#.................................................",
            "..................................................................................................................#.........................",
            "....#......#.....................................#..............................#............................#............#.....#...........",
            "....................#.............................................#....................#.........#.......................................#..",
            ".........................................................#..............#.............................#.....................................",
            "............................#...........#...........................................................................#.......................",
            "............................................................................................................................................",
            "#..................................#...............................................................#..........#.............................",
            ".......#......................................................................................#.................................#.......#...",
            ".....................#....................#...............................#.....#......................................#....................",
            "................................#..........................#......#....................#..........................#.........................",
            "..............#...................................#........................................................................#...............#",
            "....#....................................................................................................#..................................",
            ".......................#....................................................................................................................",
            "......................................#................................#..................#.................................................",
            ".....................................................#............................................#...............................#.........",
            "............................................................................................................................................",
            "............................................................................................................................................",
            "....#.................#..................................#.........................#..........................#.............................",
            ".............#........................................................................................#..................#..................",
            "......................................#............................................................................#........................",
            ".........#....................................................#.........#............................................................#......",
            ".............................................................................................#..............................................",
            ".............................#...........#............................................................................#.....................",
            "#..................#................................................#....................#.......................................#.........#",
            "...................................................................................................#......#.................................",
            "...........#.............................................#...........................#......................................................",
            "....................................#.......................................................................................................",
            "..................................................#..........#.........#......................#.....................#.......................",
            ".#......#....................................#..............................................................#...............................",
            ".............................#.............................................#................................................................",
            ".......................#...............................................................................#....................#...............",
            "....................................................#.....................................#...........................................#.....",
            "................#.....................#..................#.................................................................................#",
            "...#.....#..........................................................#................#......................................................",
            ".............................................#...............#................................#......#......................................",
            "...............................#...............................................#............................................................",
            ".............................................................................................................................#.........#....",
            ".....................#................................................#.................................................#...................",
            "...............#.........................#.......................#..................#.......................................................",
            ".....#......................................................................................................#.......................#.......",
            "....................................#.................#.........................#..................#........................................",
            "........................................................................................................................................#...",
            ".........#..............#.....................................#........................................#.....................#..............",
            "...............................................#...................#........................................................................",
            "......................................#.............#..................................#.....#.......................#......................",
            "............#.....#...............................................................................#.........................................",
            "...#...................................................................................................................................#....",
            ".......................#.........................#..........................................................................................",
            ".........................................................#...........#.........................#........#..........#.............#..........",
            "............................#..............#....................#........................................................#..................",
            ".......#.................................................................#................#.................................................",
            ".................#..................................................................................#........................#...........#..",
            "...................................................#.......#................................................................................",
            ".........................................#......................................#......................................#....................",
            "....................................#...........................................................................#...........................",
            "..............................#.............................................................#...........#.......................#......#....",
            ".........#...............................................#..............#...................................................................",
            "........................#....................#.....................................#........................................................",
            "#...........................................................................................................................................",
            "............................#......................................................................#.......#................................",
            "......................................#.....................................................................................................",
            ".....#............#.........................................#..........................#..........................................#.........",
            "...........................................#......................#..............................................#..........................",
            "..............#..............................................................................#............................#.............#...",
            "..#......#...........................................#..............................#..................#.....#..............................",
            "....................#..........#.....#...............................#......................................................................",
            "............................................................................................................................................",
            ".................................................#..........................................................................................",
            ".............#..........#...............................#...............#.............#..........#.........#........#.......................",
            "............................................#................#.................#............................................................",
            "....................................#....................................................................................#.............#...."
        ];

        private static readonly string[] DataTest =
        [
            "...#......",
            ".......#..",
            "#.........",
            "..........",
            "......#...",
            ".#........",
            ".........#",
            "..........",
            ".......#..",
            "#...#....."
        ];

        public static void Run()
        {
            string[] data = DataProd;

            (long col, long row)[] rawGalaxyMap = data.SelectMany((line, rowIdx) => line.Select((c, colIdx) => (c, colIdx, rowIdx))).Where(sector => sector.c == '#').Aggregate(new List<(long col, long row)>(), (curr, next) =>
            {
                curr.Add((next.colIdx, next.rowIdx));
                return curr;
            }).ToArray();

            // ReSharper disable once SimplifyLinqExpressionUseAll
            List<int> emptyColumns = Enumerable.Range(0, data[0].Length).Where(c => !rawGalaxyMap.Any(g => g.col == c)).ToList();
            // ReSharper disable once SimplifyLinqExpressionUseAll
            List<int> emptyRows = Enumerable.Range(0, data.Length).Where(r => !rawGalaxyMap.Any(g => g.row == r)).ToList();

            for (int part = 0; part < 2; part++)
            {
                long expansionFactor = part == 0 ? 2 : 1000000 ;

                List<(int i, long col, long row)> expandedGalaxyMap = rawGalaxyMap.Select((g, i) => (g, i)).Aggregate(new List<(int i, long col, long row)>(), (curr, next) =>
                {
                    curr.Add((next.i, next.g.col + emptyColumns.Count(c => c < next.g.col) * (expansionFactor - 1), next.g.row + emptyRows.Count(r => r < next.g.row) * (expansionFactor - 1)));
                    return curr;
                });

                Console.WriteLine($"Day 12 Part {part + 1} Answer is sum {expandedGalaxyMap.SelectMany(_ => expandedGalaxyMap, Tuple.Create).Where(pairs => pairs.Item1.i < pairs.Item2.i)
                    .Sum(pairs => Math.Abs(pairs.Item2.col - pairs.Item1.col) + Math.Abs(pairs.Item2.row - pairs.Item1.row))}.");
            }
        }
    }
}
